<!DOCTYPE HTML>
<html>
	<head>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	  <title>Testing $.proxy performances.</title>
	  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
          <script src="./js/mesure-kit.js"></script>
	</head>

<body>

<p>Simple test for proxy performances in jQuery.</p>

<button onclick="runAll()">Run all</button>

<h2>Direct call</h2>

<p>Duration: <span id="valueDirect"></span></p>
<button onclick="runDirect()">Run</button>

<h2>Inline $.proxy()</h2>

<p>Duration: <span id="valueProxy"></span></p>
<button onclick="runProxy()">Run</button>

<h2>Cached $.proxy()</h2>

<p>Duration: <span id="valueProxy2"></span></p>
<button onclick="runProxy2()">Run</button>

<h2>Wrapper function</h2>

<p>Duration: <span id="valueFn"></span></p>
<button onclick="runFn()">Run</button>

</body>

<script>

/** Simple point object.
 * 
 * @returns {Point}
 */
function Point() {
  this.x = 0.0;
  this.y = 0.0;
}

/** Compute distance with another point.
 * 
 * @param {Point} otherPoint
 * @returns {float}
 */
Point.prototype.dist = function(otherPoint) {
  var dX = (this.x - otherPoint.x);
  var dY = (this.y - otherPoint.y);
  
  d = Math.sqrt((dX * dX) + (dY * dY));
  
  return d;
};

// TESTS

var p1 = new Point(0, 0);
var p2 = new Point(3, 12);

var bench = new Bench({ nbLoop: 10000 });

var proxyFn = $.proxy(p1.dist, p1);

bench.addTest('valueDirect', function() { 
    p1.dist(p2); 
});

bench.addTest('valueProxy', function() { 
    $.proxy(p1.dist, p1)(p2); 
});

bench.addTest('valueProxy2', function() { 
    proxyFn(p2); 
});

var pt = p1; // Capture p1
bench.addTest('valueFn', function() { 
    pt.dist(p2);
});

function runAll() { bench.runAllTests(); }

function runDirect() { bench.runTest("valueDirect"); };

function runProxy()  { bench.runTest("valueProxy"); };

function runProxy2() { bench.runTest("valueProxy2"); };

function runFn()     { bench.runTest("valueFn"); };


</script>

</html>
